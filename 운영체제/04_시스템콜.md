## 1. 운영체제의 이중 모드
<img width="691" alt="스크린샷 2025-01-16 오후 8 22 53" src="https://github.com/user-attachments/assets/9f0ad6ef-490a-401f-8df4-e52291c58d61" />

CPU는 사용자 모드와 커널 모드를 수행할 수 있다. 사용자 모드는 응용 프로그램을 실행하기 위해 사용되고, 커널 모드는 운영체제를 통해 안전하게 시스템 자원에 접근하기 위해 사용된다. CPU에는 Mode 비트가 존재하는데, 비트 값이 1이라면 사용자 모드로 실행 중이고, 0이라면 커널 모드로 실행 중이다. 

CPU가 사용자 모드와 커널 모드로 구분하여 실행하는 이유는 보안과 시스템 안전성을 위해서이다. 응용 프로그램이 시스템 자원을 필요로하여 시스템 자원에 직접 접근한다면 시스템 충돌로 이어질 수 있다. 따라서 시스템 자원은 커널 모드에서 실행되는 운영체제에게만 권한을 부여하여 안전하게 시스템 자원에 접근하는 것이다. 
- 사용자 모드 : 응용 프로그램을 실행하는 것이 주 목적이고, 시스템 자원에 직접 접근할 수 없다.
- 커널 모드 : 시스템 자원에 접근하는 것이 주 목적이고, 운영체제가 커널 코드를 실행하여 시스템 자원에 접근한다.


## 2. 시스템 콜(System Call)
<img width="751" alt="스크린샷 2025-01-16 오후 8 28 27" src="https://github.com/user-attachments/assets/dedcb738-0074-4b34-a052-0da77cfb5c05" />

사용자 모드에서 실행 중인 응용 프로그램이 시스템 자원을 필요로 한다면 커널 모드로 변경해야 한다. 시스템 콜을 호출하면 트랩(Trap)에 의해 Mode 비트가 1에서 0으로 변경되어 커널 모드로 변경된다. 시스템 콜이 필요한 대표적인 예시로 파일 읽기/쓰기가 있다. 파일은 하드웨어 자원이기 때문에 운영체제를 통해서만 접근할 수 있다. 

시스템 콜을 수행하는 과정을 알아보자.
1. 응용 프로그램에서 시스템 콜 호출
- 시스템 자원은 응용 프로그램이 직접 접근할 수 없으므로, 시스템 콜을 통해 운영체제로부터 받아온다.
2. CPU가 트랩(Trap) 명령어 실행
- 트랩 명령어를 실행하면 Mode 비트가 1에서 0으로 변경되고, 커널 모드로 진입이 가능하다.
- 트랩 벡터는 시스템 콜 핸들러 주소를 CPU의 PC(Program Counter)로 매핑하여, CPU가 시스템 콜 핸들러를 호출할 수 있도록 한다.
3. 시스템 콜 핸들러에 의해 시스템 콜 서비스 루틴을 실행
- 시스템 콜 테이블(System Call Table)에는 시스템 콜을 식별하기 위한 (고유 번호, 시스템 콜 서비스 루틴) 정보가 저장되어 있다.
- 핸들러는 시스템 테이블을 참고하여 요청된 시스템 콜을 처리할 수 있는 서비스 루틴을 실행한다.
4. 서비스 루틴 처리 결과를 응용 프로그램에 전달
- 운영체제는 서비스 루틴 처리 결과를 응용 프로그램에게 전달한다.
5. 커널 모드에서 사용자 모드로 변경
- 시스템 콜 작업을 처리하였으므로, CPU는 커널 모드에서 사용자 모드로 다시 변경한다.
- Mode 비트 : 0 -> 1
CPU가 다시 사용자 모드로 변경되고 운영체제로부터 받은 시스템 콜 결과를 사용하여 작업을 이어간다.
