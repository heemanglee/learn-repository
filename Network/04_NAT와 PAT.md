## 1. NAT(Network Address Translation, 네트워크 주소 변환)
NAT(Network Address Translation)은 사설 IP 주소(Private IP)를 공인 IP 주소(Public IP)로 변환하여 인터넷과 통신할 수 있도록 한다. NAT가 사용되는 이유는 IPv4 주소 부족 문제를 해결하기 위해 사용된다.
- 사설 IP(Private IP) : 내부 네트워크에서만 사용 
- 공인 IP(Public IP ) : 인터넷에서 고유하게 사용

집이나 카페에 설치된 공유기로부터 WIFI를 연결하여 인터넷을 사용할 수 있다. 공유기는 DHCP 서버 역할을 하므로 WIFI에 연결된 장치들에게 동적으로 사설 IP를 할당한다. 여러 장치가 동일한 WIFI에 연결한다면 각 장치에 할당되는 사설 IP 주소가 다르다. 각 장치는 공유기가 속한 네트워크 대역 범위 내에서 사설 IP 주소를 할당받아 사용하게 된다.

- 네트워크 대역 : 192.168.1.0/24 (192.168.1.1 ~ 192.168.1.254)

| 장치       | 사설 IP 주소 (DHCP에서 할당) |
|-----------|---------------------------|
| 카페 공유기 | 192.168.1.1 (고정)       |
| 노트북     | 192.168.1.100 (동적 할당) |
| 휴대폰     | 192.168.1.101 (동적 할당) |

NAT은 내부 네트워크의 사설 IP 주소를 공인 IP 주소로 변환하여 외부 인터넷과 통신할 수 있도록 한다. 또한, 인터넷에서 응답이 오면 NAT에 의해 다시 원래의 사설 IP 주소로 변환되어 내부 네트워크에 전달하는 역할도 수행한다.

맥북 사용자는 연결된 WIFI 상세 정보를 클릭하여 공유기(DHCP 서버)로부터 할당받은 사설 IP 주소를 확인할 수 있다. 또한, 다른 장치로 동일한 WIFI에 연결했을 때 할당받은 사설 IP 주소가 다른 것도 확인할 수 있다.
<img width="701" alt="image" src="https://github.com/user-attachments/assets/38b08ef2-00a4-4d41-b14a-44dbcbc4499f" />

---

## 2. NAT만 단독으로 사용하는 것이 아닌 PAT(Port Address Translation)을 같이 사용한다.
NAT가 사설 IP 주소를 공인 IP 주소로 변환하는 것을 알았다. 그러나 NAT만 사용해서는 IPv4 주소 체계에서 주소 부족 문제를 해결할 수 없다. NAT은 기본적으로 사설 IP를 공인 IP로 변환하지만 하나의 공인 IP를 여러 장치가 공유할 수는 없다. 이 문제를 해결하기 위해 Port 번호를 사용해 공인 IP를 공유하는 각 장치를 식별하는 PAT(Port Address Translation)이 필요하다.

PAT은 내부 네트워크의 여러 장치가 같은 공인 IP를 공유하더라도 각 장치의 요청을 식별할 수 있도록 출발지 Port 번호를 변환하여 식별한다.

| 장치       | 사설 IP         |출발지 Port  | 공인 IP       | PAT에 의해 변환된 출발지 Port  |
|----------|-------------------------|-------------|--------------|----------------------------|
| 노트북     | 192.168.1.100 (동적 할당) | 50000       | 203.0.113.25 | 30000
| 휴대폰     | 192.168.1.101 (동적 할당) | 50000       | 203.0.113.25 | 30001

노트북과 휴대폰이 사용하는 공인 IP가 동일하지만, PAT에 의해 출발지 Port 번호가 변경되어 식별이 가능하다. PAT 덕분에 여러 장치가 하나의 공인 IP를 공유하여 IPv4 주소 부족 문제를 해결할 수 있다.

---

## 3. 송신지 -> 수신지로 패킷을 전송했을 때의 과정
> - 로컽 환경(ex. 노트북)에 할당된 사설 IP : 192.168.0.100
> - 공유기에 할당된 공인 IP : 203.0.113.25
> - AWS 서버의 공인 IP : 15.165.20.50

위 환경을 바탕으로 패킷을 전송하는 과정은 다음과 같다.
1. 로컬 환경에서 AWS 서버로 요청을 보낸다.
  - 요청 패킷의 출발지 IP : 192.168.0.100
  - 요청 패킷의 출발지 Port : 5000
  - 요청 패킷의 목적지 IP : 15.165.20.50
  - 요청 패킷의 목적지 Port : 443 (HTTPS)
2. NAT 라우터에서 출발지 IP 및 Port 변환
  - 요청 패킷의 출발지 IP : 192.168.0.100 -> `203.0.113.25`
  - 요청 패킷의 출발지 Port : 5000 -> `30000`
  - 요청 패킷의 목적지 IP : 15.165.20.50 (변경 없음)
  - 요청 패킷의 목적지 Port : 443 (변경 없음)
3. AWS 서버에서 로컬 환경으로 응답 패킷 전송
  - 응답 패킷의 출발지 IP : 15.165.20.50
  - 응답 패킷의 출발지 Port : 443
  - 응답 패킷의 목적지 IP : 203.0.113.25
  - 응답 패킷의 목적지 Port : 30000
4. NAT 라우터에서 목적지 IP 변환
  - 응답 패킷의 출발지 IP : 15.165.20.50 (변경 없음)
  - 응답 패킷의 출발지 Port : 443 (변경 없음)
  - 응답 패킷의 목적지 IP : 203.0.113.25 -> `192.168.0.100`
  - 응답 패킷의 목적지 Port : 30000 -> `5000`

## 📌 4. NAT의 핵심 개념 요약
- 인터넷 환경에서는 `공인 IP(Public IP)`만 사용되므로 NAT가 내부 네트워크의 `사설 IP`를 `공인 IP`로 변환해야 한다.
- NAT 라우터는 단순히 `IP 주소`를 변경하는 것이 아니라 `Port 번호`까지 변환하는 역할(PAT)도 수행하여 여러 장치가 하나의 공인 IP를 공유하도록 하여 IPv4 주소체계에서 주소 부족 문제를 해결할 수 있다.
